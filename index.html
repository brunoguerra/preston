<!DOCTYPE html>

<html lang="en">
<head>
	<meta charset="utf-8">
	<title>Restifier Index</title>

	<!--[if lt IE 9]>
	<script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
	<![endif]-->
	<link type="text/css" rel="stylesheet" href="styles/sunlight.default.css">

	<link type="text/css" rel="stylesheet" href="styles/site.spacelab.css">

</head>

<body>
<div class="container-fluid">
	<div class="navbar navbar-fixed-top navbar-inverse">
		<div class="navbar-inner">
			<a class="brand" href="index.html">Restifier</a>
			<ul class="nav">
				
				<li class="dropdown">
					<a href="classes.list.html" class="dropdown-toggle" data-toggle="dropdown">Classes<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="Model.html">Model</a>
						</li>
						
						<li>
							<a href="RestAPI.html">RestAPI</a>
						</li>
						

					</ul>
				</li>
				
				<li class="dropdown">
					<a href="global.html" class="dropdown-toggle" data-toggle="dropdown">Global<b
						class="caret"></b></a>

					<ul class="dropdown-menu ">
						
						<li>
							<a href="global.html#api">api</a>
						</li>
						
						<li>
							<a href="global.html#restifier">restifier</a>
						</li>
						

					</ul>
				</li>
				
			</ul>
		</div>
	</div>

	<div class="row-fluid">

		
		<div class="span8">
			
				<div id="main">
					


	
	<span class="page-title">Index</span>
	
	












	
	





    <section class="readme-section">
        <article><h1>restifier</h1>
<p>Serves Mongoose models on an extensible RESTful API.</p>
<p><a href="https://waffle.io/simplyianm/restifier"><img src="https://badge.waffle.io/simplyianm/restifier.png?label=ready&amp;title=Ready" alt="Stories in Ready"></a>
<a href="http://travis-ci.org/simplyianm/restifier"><img src="https://secure.travis-ci.org/simplyianm/restifier.png" alt="build status"></a></p>
<h2>Installation</h2>
<p>This module is installed via npm:</p>
<pre><code class="lang-bash">$ npm install restifier --save</code></pre>
<h2>Example</h2>
<p>The following example serves the <code>User</code> and <code>Page</code> models on a RESTful API.</p>
<pre><code class="lang-js">var express = require('express');
var restifier = require('restifier');
var models = require('./models'); // Your mongoose models would be loaded here

var app = express();

app.use(require('body-parser').json()); // Required

restifier(mongoose.model('User'), mongoose.model('Page')); // Add models
app.use('/api', restifier.middleware()); // Serve the api on /api.

app.listen(3000);</code></pre>
<h2>REST API</h2>
<p>Restifier uses the MongoDB collection name to determine the name of the base route, so the <code>User</code> model would create routes under <code>/users</code>.</p>
<h3>Query</h3>
<p>Querying takes in the following parameters:
<em> <code>field</code> - Replace <code>field</code> with any field in your Mongoose model, and it will check for equality.
</em> <code>populate</code> - Comma-delimited list of fields to populate
<em> <code>sort</code> - Sorts by the given fields in the given order, comma delimited. A <code>-</code> sign will sort descending.
</em> <code>limit</code> - Limits the number of returned results.
<em> <code>skip</code> - Skips a number of results. Useful for pagination when combined with <code>limit</code>.
</em> <code>filter</code> - Applies a filter. See the Filters section for more details.</p>
<pre><code>GET /users
GET /users?field=value
GET /users?populate=posts,comments
GET /users?sort=field,-field2
GET /users?limit=10&amp;skip=10
GET /users?filter=filter1|filter2
GET /users/Bob/badges?sort=date</code></pre>
<h3>Create</h3>
<pre><code>POST /users
POST /users/Bob/badges</code></pre>
<h3>Get</h3>
<p>Get supports one parameter, the <code>populate</code> field.</p>
<pre><code>GET /users/Bob
GET /users/Bob?populate=posts
GET /users/Bob/badges/1
GET /users/Bob/badges/1?populate=things</code></pre>
<h3>Update</h3>
<pre><code>PUT /users/Bob
PATCH /users/Bob
PUT /users/Bob/badges/1
PATCH /users/Bob/badges/1</code></pre>
<h3>Destroy</h3>
<pre><code>DELETE /users/Bob
DELETE /users/Bob/badges/1</code></pre>
<h2>Creating an API</h2>
<p>First, declare all of your models using <code>restifier(mongooseModel)</code>. This function returns a <code>Model</code> object which can be altered. (see the JSDocs)</p>
<p>Next, serve the API as middleware:</p>
<pre><code>app.use('/api', restifier.middleware());</code></pre>
<p>This will create a middleware that will be used by Express.</p>
<h3>Namespace Collision</h3>
<p>In the case of namespace collision, routes are handled sequentially by Express. Declare your custom routes
before using the middleware. For example:</p>
<pre><code>app.post('/api/login', myLoginHandler);
app.use('/api', restifier.middleware());</code></pre>
<p>is the appropriate way to add functionality to your API.</p>
<h2>The Query Pipeline</h2>
<p>Restifier was designed to be very flexible so it could be used as a backend for any app. Thus, queries go through a series of steps before being transformed into what is sent to the client.</p>
<pre><code>Modifiers --&gt; Parameters --&gt; Filters --&gt; Population --&gt; Execution --&gt; Transformers</code></pre>
<h3>Modifiers</h3>
<p>Modifiers alter the query parameters that will be passed to the pipeline. For example, you could have a modifier that forces sorting by name ascending, as shown below:</p>
<pre><code class="lang-js">model.modifyParam('sort', function(req, value) {
  value.name = 1;
  return value;
});</code></pre>
<p>To modify a parameter, just pass the name of the parameter you wish to modify and a callback that returns the modified value of the parameter.</p>
<p><code>sort</code> and <code>populate</code> are the only parameters that are objects.</p>
<p>The <code>sort</code> parameter looks like this:</p>
<pre><code class="lang-js">{
  name: 1, // Ascending
  date: -1 // Descending
}</code></pre>
<p>The <code>populate</code> parameter looks like this:</p>
<pre><code class="lang-js">['users', 'comments', 'posts']</code></pre>
<h3>Parameters</h3>
<p>There are 4 types of parameters: limit, skip, sort, and field equality. These are all described in the <a href="#query">Query</a> section.</p>
<h3>Filters</h3>
<p>Filters are user-defined functions that modify the query. They work very similarly to AngularJS filters. They can be chained and take parameters, allowing immense flexibility for developers to add features to APIs.</p>
<p>Filters are defined as follows:</p>
<pre><code class="lang-js">model.filter('children', function(req, query) {
  query.where('age').lt(18);
});</code></pre>
<p>Here is an example of a filter that takes parameters:</p>
<pre><code class="lang-js">model.filter('proximity', function(req, query, distance) {
  query.where('location').maxDistance(distance);
});</code></pre>
<p>This filter would be called using <code>proximity 5</code> if one wanted to check if the location was within a distance of 5.</p>
<p>Chaining filters is pretty simple; just use the <code>|</code> (pipe) operator to do so.</p>
<pre><code>GET /people?filter=children | proximity 5</code></pre>
<h3>Population</h3>
<p>Fields that were marked for population in the query are now populated. You can change what fields are returned using <a href="#population-transformers">population transformers</a>.</p>
<h3>Execution</h3>
<p>At this point in the pipeline, <code>query.exec()</code> is called and we query the database.</p>
<h3>Transformers</h3>
<p>Transformers change the returned results. One transformer is built in, the <code>restricted</code> transformer, and cannot be changed. Here is an example of using a transformer:</p>
<pre><code class="lang-js">model.transform(function(req, doc) {
  delete doc._id;
  delete doc.password;
  doc.type = 'This is a string that isn\'t in the database!';
});</code></pre>
<p>Transformers are applied to each individual document in a query result.</p>
<h4>Population Transformers</h4>
<p>Population transformers are transformers that operate on populated fields. They can be used to make your application more secure by removing fields you don't want people to see.</p>
<pre><code class="lang-js">model.transformPopulate('owners', function(req, doc) {
  delete doc._id;
  delete doc.password;
});</code></pre>
<h2>License</h2>
<p>Copyright (c) 2014 Ian Macalinao. Released under the MIT License, which can be viewed in the attached <code>LICENSE</code> file.</p></article>
    </section>







				</div>

				<div class="clearfix"></div>
				<footer>
					
					
		<span class="copyright">
		Copyright (c) 2014 Ian Macalinao. Released under the MIT License.
		</span>
					<br />
					
		<span class="jsdoc-message">
		Documentation generated by <a href="https://github.com/jsdoc3/jsdoc">JSDoc 3.2.2</a>
		on Mon Aug 4th 2014 using the <a
			href="https://github.com/terryweiss/docstrap">DocStrap template</a>.
		</span>
				</footer>
			</div>

			
			<div class="span3">
				<div id="toc"></div>
			</div>
			
			<br clear="both">
		</div>

	</div>
	<!--<script src="scripts/sunlight.js"></script>-->
	<script src="scripts/docstrap.lib.js"></script>
	<script src="scripts/bootstrap-dropdown.js"></script>
	<script src="scripts/toc.js"></script>

	<script>
		$( function () {
			$( "[id*='$']" ).each( function () {
				var $this = $( this );

				$this.attr( "id", $this.attr( "id" ).replace( "$", "__" ) );
			} );

			$( "#toc" ).toc( {
				anchorName  : function ( i, heading, prefix ) {
					return $( heading ).attr( "id" ) || ( prefix + i );
				},
				selectors   : "h1,h2,h3,h4",
				showAndHide : false,
				scrollTo    : "100px"
			} );

			$( "#toc>ul" ).addClass( "nav nav-pills nav-stacked" );
			$( "#main span[id^='toc']" ).addClass( "toc-shim" );
			$( '.dropdown-toggle' ).dropdown();
//			$( ".tutorial-section pre, .readme-section pre" ).addClass( "sunlight-highlight-javascript" ).addClass( "linenums" );

			$( ".tutorial-section pre, .readme-section pre" ).each( function () {
				var $this = $( this );

				var example = $this.find( "code" );
				exampleText = example.html();
				var lang = /{@lang (.*?)}/.exec( exampleText );
				if ( lang && lang[1] ) {
					exampleText = exampleText.replace( lang[0], "" );
					example.html( exampleText );
					lang = lang[1];
				} else {
					lang = "javascript";
				}

				if ( lang ) {

					$this
						.addClass( "sunlight-highlight-" + lang )
						.addClass( "linenums" )
						.html( example.html() );

				}
			} );

			Sunlight.highlightAll( {
				lineNumbers : true,
				showMenu : true,
				enableDoclinks : true
			} );
		} );
	 </script>



	<!--Navigation and Symbol Display-->
	


	<!--Google Analytics-->
	

</body>
</html>